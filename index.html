<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L·ªãch Pokemon Widget</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome cho icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Font ch·ªØ phong c√°ch game -->
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f3f4f6;
            /* Pattern n·ªÅn Pokeball m·ªù */
            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .pixel-font {
            font-family: 'VT323', monospace;
        }

        /* Hi·ªáu ·ª©ng th·∫ª Pokemon */
        .poke-card {
            transition: all 0.3s ease;
            transform-style: preserve-3d;
        }
        
        /* Hi·ªáu ·ª©ng cho ng√†y ƒë·∫∑c bi·ªát (L·ªÖ, T·∫øt) */
        .special-day-effect {
            animation: holy-glow 2s infinite alternate;
            border: 2px solid #fbbf24;
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
        }

        .special-day-img {
            filter: drop-shadow(0 0 10px #fbbf24);
            animation: bounce 2s infinite;
        }

        .sparkle {
            position: absolute;
            width: 20px;
            height: 20px;
            background: url('https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/shining-gem.png') no-repeat center/contain;
            animation: sparkle-anim 1.5s infinite;
            z-index: 10;
        }

        @keyframes holy-glow {
            from { box-shadow: 0 0 10px #fbbf24, 0 0 20px #f59e0b; }
            to { box-shadow: 0 0 20px #fbbf24, 0 0 40px #d97706; }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px) scale(1.05); }
        }

        @keyframes sparkle-anim {
            0% { opacity: 0; transform: scale(0.5) rotate(0deg); }
            50% { opacity: 1; transform: scale(1.2) rotate(180deg); }
            100% { opacity: 0; transform: scale(0.5) rotate(360deg); }
        }

        /* Ch·∫ø ƒë·ªô Widget gi·∫£ l·∫≠p */
        .widget-container {
            aspect-ratio: 1/1; /* H√¨nh vu√¥ng */
            max-width: 350px; /* K√≠ch th∆∞·ªõc t∆∞∆°ng ƒë∆∞∆°ng b·ªÅ ngang ƒëi·ªán tho·∫°i */
            margin: 0 auto;
            border-radius: 24px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }

        /* ·∫®n thanh cu·ªôn cho danh s√°ch l·ªãch */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="min-h-screen text-gray-800 pb-10">

    <!-- Header -->
    <header class="bg-red-600 text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold flex items-center gap-2">
                <i class="fa-solid fa-circle-half-stroke rotate-90"></i> PokeCalendar
            </h1>
            <button onclick="scrollToToday()" class="bg-white text-red-600 px-3 py-1 rounded-full text-sm font-bold shadow hover:bg-red-50 transition">
                H√¥m nay
            </button>
        </div>
    </header>

    <main class="container mx-auto px-4 mt-6">
        
        <!-- SECTION 1: WIDGET MODE (C√°i khung to nh∆∞ b·∫°n y√™u c·∫ßu) -->
        <div class="mb-8">
            <h2 class="text-lg font-bold text-gray-500 mb-2 text-center uppercase tracking-wider">Widget H√¥m Nay</h2>
            
            <!-- ƒê√¢y l√† c√°i khung Widget -->
            <div id="widget-display" class="widget-container bg-white relative overflow-hidden flex flex-col justify-between p-6 cursor-pointer transform hover:scale-[1.02] transition">
                
                <!-- Background Decoration -->
                <div class="absolute -right-10 -top-10 w-40 h-40 bg-red-100 rounded-full opacity-50 z-0"></div>
                <div class="absolute -left-10 -bottom-10 w-32 h-32 bg-blue-100 rounded-full opacity-50 z-0"></div>

                <!-- Date Info -->
                <div class="relative z-10 flex justify-between items-start h-1/4">
                    <div>
                        <p id="widget-day-name" class="text-red-500 font-bold text-xl uppercase tracking-wide">Th·ª© Hai</p>
                        <p id="widget-date" class="text-6xl font-black text-gray-800 pixel-font leading-none">01</p>
                        <p id="widget-month" class="text-gray-500 font-medium text-lg">Th√°ng 1</p>
                    </div>
                    <!-- Type Icon Placeholder -->
                    <div id="type-icon" class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-xs text-gray-500">
                        <i class="fa-solid fa-bolt"></i>
                    </div>
                </div>

                <!-- Pokemon Main Image - ƒêi·ªÅu ch·ªânh size ƒë·ªÉ kh√¥ng che m·∫•t t√™n -->
                <div class="relative z-10 flex-1 flex items-center justify-center min-h-0">
                    <div id="special-effects-container"></div> <!-- Container cho hi·ªáu ·ª©ng l·∫•p l√°nh -->
                    <img id="widget-poke-img" src="" alt="Pokemon" class="w-auto h-40 object-contain drop-shadow-xl transition-all duration-500">
                </div>

                <!-- Pokemon Name & Event - S·ª≠a layout ƒë·ªÉ t√™n kh√¥ng b·ªã m·∫•t -->
                <div class="relative z-10 text-center h-auto min-h-[3rem] flex flex-col justify-end pb-1">
                    <p id="widget-event-text" class="text-[10px] text-yellow-600 font-bold uppercase tracking-wider mb-0.5 -mt-1 h-3"></p> <!-- Text cho ng√†y l·ªÖ nh·ªè l·∫°i v√† x√≠ch l√™n -->
                    <p id="widget-poke-name" class="text-lg font-bold capitalize text-gray-800 leading-tight">Loading...</p>
                </div>
            </div>
            <p class="text-center text-xs text-gray-400 mt-2 italic">Ch·∫°m v√†o widget ƒë·ªÉ xem chi ti·∫øt ho·∫∑c ƒë·ªïi ng√†y</p>
        </div>

        <!-- SECTION 2: GRID L·ªäCH (Chi ti·∫øt c√°c ng√†y trong th√°ng) -->
        <div class="bg-white rounded-xl shadow-md p-4">
            <div class="flex justify-between items-center mb-4">
                <button onclick="changeMonth(-1)" class="p-2 hover:bg-gray-100 rounded-full"><i class="fa-solid fa-chevron-left"></i></button>
                <h2 id="calendar-month-year" class="text-xl font-bold capitalize">Th√°ng 1, 2026</h2>
                <button onclick="changeMonth(1)" class="p-2 hover:bg-gray-100 rounded-full"><i class="fa-solid fa-chevron-right"></i></button>
            </div>

            <!-- C√°c ng√†y trong tu·∫ßn -->
            <div class="grid grid-cols-7 gap-1 mb-2 text-center text-xs font-bold text-gray-400 uppercase">
                <div>CN</div>
                <div>T2</div>
                <div>T3</div>
                <div>T4</div>
                <div>T5</div>
                <div>T6</div>
                <div>T7</div>
            </div>

            <!-- L∆∞·ªõi ng√†y -->
            <div id="calendar-grid" class="grid grid-cols-7 gap-1">
                <!-- Javascript s·∫Ω render ng√†y v√†o ƒë√¢y -->
            </div>
        </div>

    </main>

    <!-- Modal chi ti·∫øt (Khi click v√†o ng√†y trong l·ªãch) -->
    <div id="detail-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4" onclick="closeModal()">
        <div class="bg-white rounded-2xl p-6 w-full max-w-sm transform scale-95 transition-transform duration-200" onclick="event.stopPropagation()">
            <div class="text-right">
                <button onclick="closeModal()" class="text-gray-400 hover:text-red-500"><i class="fa-solid fa-xmark fa-lg"></i></button>
            </div>
            <div class="text-center">
                <p id="modal-date" class="text-gray-500 font-medium">--/--/----</p>
                <div class="my-4 relative h-40 flex items-center justify-center">
                     <img id="modal-img" src="" class="h-full object-contain drop-shadow-lg">
                </div>
                <h3 id="modal-name" class="text-2xl font-bold capitalize mb-2">Pokemon Name</h3>
                <p id="modal-desc" class="text-sm text-gray-600">Pokemon ƒë·∫∑c tr∆∞ng cho ng√†y n√†y!</p>
                <button onclick="setAsActiveWidget()" class="mt-6 w-full bg-red-500 text-white py-3 rounded-xl font-bold hover:bg-red-600 shadow-md">
                    Xem tr√™n Widget
                </button>
            </div>
        </div>
    </div>

    <script>
        // C·∫•u h√¨nh
        const POKE_API_BASE = "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/";
        // S·ª≠ d·ª•ng ·∫£nh nh·ªè h∆°n cho danh s√°ch l∆∞·ªõi ƒë·ªÉ t·∫£i nhanh h∆°n
        const POKE_ICON_BASE = "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/"; 
        const TOTAL_POKEMON = 1025; // S·ªë l∆∞·ª£ng Pokemon hi·ªán t·∫°i

        // Danh s√°ch ng√†y l·ªÖ ƒë·∫∑c bi·ªát (Th√°ng b·∫Øt ƒë·∫ßu t·ª´ 0)
        // ƒê√£ b·ªï sung th√™m c√°c ng√†y l·ªÖ nh·ªè theo y√™u c·∫ßu
        const SPECIAL_DAYS = [
            { d: 1, m: 0, name: "T·∫øt D∆∞∆°ng L·ªãch", effect: "fireworks" }, 
            { d: 14, m: 1, name: "Valentine", effect: "heart" }, 
            { d: 8, m: 2, name: "Q.T·∫ø Ph·ª• N·ªØ", effect: "flower" }, 
            { d: 10, m: 2, name: "Gi·ªó T·ªï H√πng V∆∞∆°ng", effect: "incense" }, // Gi·∫£ ƒë·ªãnh ng√†y d∆∞∆°ng (thay ƒë·ªïi theo nƒÉm √¢m)
            { d: 30, m: 3, name: "Gi·∫£i Ph√≥ng MN", effect: "star" }, 
            { d: 1, m: 4, name: "Q.T·∫ø Lao ƒê·ªông", effect: "star" }, 
            { d: 1, m: 5, name: "Q.T·∫ø Thi·∫øu Nhi", effect: "balloon" }, // 1/6
            { d: 27, m: 6, name: "TB-Li·ªát Sƒ©", effect: "candle" }, // 27/7
            { d: 19, m: 7, name: "CM Th√°ng 8", effect: "flag" }, // 19/8
            { d: 2, m: 8, name: "Qu·ªëc Kh√°nh", effect: "flag" }, // 2/9
            { d: 10, m: 9, name: "Gi·∫£i Ph√≥ng Th·ªß ƒê√¥", effect: "star" }, // 10/10
            { d: 20, m: 9, name: "Ph·ª• N·ªØ VN", effect: "flower" }, // 20/10
            { d: 31, m: 9, name: "Halloween", effect: "ghost" }, // 31/10
            { d: 20, m: 10, name: "Nh√† Gi√°o VN", effect: "book" }, // 20/11
            { d: 22, m: 11, name: "Qƒê Nh√¢n D√¢n", effect: "star" }, // 22/12
            { d: 25, m: 11, name: "Gi√°ng Sinh", effect: "snow" }, 
            { d: 17, m: 1, name: "T·∫øt Nguy√™n ƒê√°n", effect: "tet" } // Gi·∫£ l·∫≠p
        ];

        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let selectedDate = new Date(); // Ng√†y ƒëang ƒë∆∞·ª£c ch·ªçn ƒë·ªÉ hi·ªÉn th·ªã l√™n widget

        // H√†m kh·ªüi t·∫°o
        document.addEventListener('DOMContentLoaded', () => {
            renderCalendar(currentMonth, currentYear);
            updateWidget(new Date()); // M·∫∑c ƒë·ªãnh hi·ªÉn th·ªã h√¥m nay
        });

        // H√†m l·∫•y ID Pokemon d·ª±a tr√™n ng√†y (Deterministic: C√πng ng√†y lu√¥n ra c√πng Pokemon)
        function getPokemonIdForDate(date) {
            const startOfYear = new Date(date.getFullYear(), 0, 0);
            const diff = date - startOfYear;
            const oneDay = 1000 * 60 * 60 * 24;
            const dayOfYear = Math.floor(diff / oneDay);
            
            // C√¥ng th·ª©c: (Ng√†y trong nƒÉm + NƒÉm) % T·ªïng s·ªë Pokemon + 1
            // C·ªông th√™m nƒÉm ƒë·ªÉ nƒÉm sau kh√°c nƒÉm tr∆∞·ªõc
            let pokeId = ((dayOfYear + date.getFullYear()) % TOTAL_POKEMON) + 1;
            return pokeId;
        }

        // Ki·ªÉm tra ng√†y l·ªÖ
        function checkSpecialDay(date) {
            return SPECIAL_DAYS.find(s => s.d === date.getDate() && s.m === date.getMonth());
        }

        // C·∫≠p nh·∫≠t Widget L·ªõn
        function updateWidget(date) {
            selectedDate = date;
            
            // C·∫≠p nh·∫≠t text ng√†y th√°ng
            const days = ['Ch·ªß Nh·∫≠t', 'Th·ª© Hai', 'Th·ª© Ba', 'Th·ª© T∆∞', 'Th·ª© NƒÉm', 'Th·ª© S√°u', 'Th·ª© B·∫£y'];
            document.getElementById('widget-day-name').textContent = days[date.getDay()];
            document.getElementById('widget-date').textContent = date.getDate().toString().padStart(2, '0');
            document.getElementById('widget-month').textContent = `Th√°ng ${date.getMonth() + 1}`;

            // L·∫•y th√¥ng tin Pokemon
            const pokeId = getPokemonIdForDate(date);
            const imgUrl = `${POKE_API_BASE}${pokeId}.png`;
            
            const widgetImg = document.getElementById('widget-poke-img');
            const widgetContainer = document.getElementById('widget-display');
            const effectContainer = document.getElementById('special-effects-container');
            const eventText = document.getElementById('widget-event-text');
            const widgetName = document.getElementById('widget-poke-name');

            // Reset hi·ªáu ·ª©ng
            widgetImg.src = imgUrl;
            widgetContainer.className = "widget-container bg-white relative overflow-hidden flex flex-col justify-between p-6 cursor-pointer transform transition shadow-lg";
            // Gi·∫£m k√≠ch th∆∞·ªõc ·∫£nh trong class ƒë·ªÉ ch·ª´a ch·ªó cho t√™n
            widgetImg.className = "w-auto h-40 object-contain drop-shadow-xl transition-all duration-500 z-10";
            effectContainer.innerHTML = '';
            eventText.textContent = "";
            widgetName.textContent = "Loading..."; // Reset text while loading

            // L·∫•y t√™n Pokemon
            fetch(`https://pokeapi.co/api/v2/pokemon/${pokeId}`)
                .then(res => res.json())
                .then(data => {
                    widgetName.textContent = data.name;
                })
                .catch(() => {
                    widgetName.textContent = `Pokemon #${pokeId}`;
                });

            // Ki·ªÉm tra ng√†y l·ªÖ ƒë·ªÉ th√™m hi·ªáu ·ª©ng
            const special = checkSpecialDay(date);
            if (special) {
                widgetContainer.classList.add("special-day-effect");
                widgetImg.classList.add("special-day-img");
                eventText.textContent = `‚òÖ ${special.name} ‚òÖ`;
                
                // Th√™m c√°c h·∫°t l·∫•p l√°nh
                for(let i=0; i<5; i++) {
                    const sparkle = document.createElement('div');
                    sparkle.className = 'sparkle';
                    sparkle.style.top = Math.random() * 80 + 10 + '%';
                    sparkle.style.left = Math.random() * 80 + 10 + '%';
                    sparkle.style.animationDelay = Math.random() + 's';
                    effectContainer.appendChild(sparkle);
                }
            }
        }

        // Render L∆∞·ªõi L·ªãch
        function renderCalendar(month, year) {
            const grid = document.getElementById('calendar-grid');
            const monthYearText = document.getElementById('calendar-month-year');
            grid.innerHTML = "";
            
            monthYearText.textContent = `Th√°ng ${month + 1}, ${year}`;

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            // C√°c √¥ tr·ªëng tr∆∞·ªõc ng√†y m√πng 1
            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                grid.appendChild(emptyCell);
            }

            // C√°c ng√†y trong th√°ng
            const today = new Date();
            for (let i = 1; i <= daysInMonth; i++) {
                const date = new Date(year, month, i);
                const pokeId = getPokemonIdForDate(date);
                const isToday = (i === today.getDate() && month === today.getMonth() && year === today.getFullYear());
                const isSpecial = checkSpecialDay(date);

                const cell = document.createElement('div');
                cell.className = `
                    aspect-square rounded-lg p-1 border border-gray-100 flex flex-col items-center justify-between cursor-pointer hover:bg-gray-50 transition relative overflow-hidden
                    ${isToday ? 'bg-red-50 border-red-300 ring-2 ring-red-200' : 'bg-white'}
                    ${isSpecial ? 'bg-yellow-50 border-yellow-300' : ''}
                `;
                
                cell.onclick = () => openDetail(date);

                // S·ªë ng√†y
                const dayNum = document.createElement('span');
                dayNum.className = "text-xs font-bold text-gray-500 z-10";
                dayNum.textContent = i;
                if(isSpecial) dayNum.classList.add('text-yellow-600');

                // ·∫¢nh Pokemon nh·ªè (D√πng sprite icon cho nh·∫π)
                const img = document.createElement('img');
                img.src = `${POKE_ICON_BASE}${pokeId}.png`;
                img.className = "w-full h-full object-contain z-0 -mt-2 opacity-80";
                img.loading = "lazy";

                // D·∫•u ch·∫•m ƒë√°nh d·∫•u ng√†y l·ªÖ
                if (isSpecial) {
                    const dot = document.createElement('div');
                    dot.className = "absolute top-1 right-1 w-2 h-2 bg-yellow-400 rounded-full animate-pulse";
                    cell.appendChild(dot);
                }

                cell.appendChild(dayNum);
                cell.appendChild(img);
                grid.appendChild(cell);
            }
        }

        // Modal Logic
        let modalTargetDate = null;

        function openDetail(date) {
            modalTargetDate = date;
            const modal = document.getElementById('detail-modal');
            const modalDate = document.getElementById('modal-date');
            const modalImg = document.getElementById('modal-img');
            const modalName = document.getElementById('modal-name');
            const modalDesc = document.getElementById('modal-desc');

            const pokeId = getPokemonIdForDate(date);
            const special = checkSpecialDay(date);

            modalDate.textContent = `Ng√†y ${date.getDate()} th√°ng ${date.getMonth() + 1}, ${date.getFullYear()}`;
            modalImg.src = `${POKE_API_BASE}${pokeId}.png`;
            
            // Fetch name (ho·∫∑c d√πng cache n·∫øu app ph·ª©c t·∫°p h∆°n)
            fetch(`https://pokeapi.co/api/v2/pokemon/${pokeId}`)
                .then(res => res.json())
                .then(data => modalName.textContent = data.name)
                .catch(() => modalName.textContent = `Pokemon #${pokeId}`);

            if (special) {
                modalDesc.textContent = `üéâ S·ª± ki·ªán: ${special.name}`;
                modalDesc.className = "text-yellow-600 font-bold animate-bounce";
            } else {
                modalDesc.textContent = "Ch·∫°m 'Xem tr√™n Widget' ƒë·ªÉ ƒë∆∞a ra m√†n h√¨nh ch√≠nh.";
                modalDesc.className = "text-sm text-gray-600";
            }

            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeModal() {
            document.getElementById('detail-modal').classList.add('hidden');
            document.getElementById('detail-modal').classList.remove('flex');
        }

        function setAsActiveWidget() {
            if(modalTargetDate) {
                updateWidget(modalTargetDate);
                closeModal();
                // Scroll to top smooth
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // Navigation
        function changeMonth(step) {
            currentMonth += step;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar(currentMonth, currentYear);
        }

        function scrollToToday() {
            const today = new Date();
            currentMonth = today.getMonth();
            currentYear = today.getFullYear();
            renderCalendar(currentMonth, currentYear);
            updateWidget(today);
        }

    </script>
</body>
</html>